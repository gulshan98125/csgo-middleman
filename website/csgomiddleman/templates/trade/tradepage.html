<!DOCTYPE html>
<html>
<head>
{% load static from staticfiles %}



<link href="{% static 'css/bootstrap.css' %}" rel="stylesheet" type="text/css">
<style> 
.container { border:2px solid #ccc; width:40vw; height: 24vh; overflow-y: scroll; }
input[type=checkbox]
{
  /* Double-sized Checkboxes */
  -ms-transform: scale(2); /* IE */
  -moz-transform: scale(2); /* FF */
  -webkit-transform: scale(1.4); /* Safari and Chrome */
  -o-transform: scale(2); /* Opera */
  padding: 10px;
}

.popupBox {
	height: 20vh;
	width: 15vw;
    visibility:hidden;
    opacity:0;        
    transition:visibility 0s linear 0.3s,opacity 0.3s linear;
    transition: all 0.4s ease;
    transition-delay:  0.1s;

}
.popupHoverElement:hover > .popupBox {
    visibility:visible;
    opacity:1;
    transition: all 0.3s ease;
    transition-delay:  0s;        
}       

img {
	max-width:100%;
max-height:100%;
}


#two {
    background: none repeat scroll 0 0 #EEEEEE;
    border: 1px solid #DADADA;
    color: #333333;
    overflow:hidden;
    left: 10vw;
    line-height: 10px;
    position: absolute;
    top: 30px;
}
</style>

</head>
<body style="overflow-x: hidden">

<div class="row" style="height: 5vh; background-color: black; font-size:160%; color:#1E90FF">
	<div class="col-sm-6"> Trade Link is:  &nbsp &nbsp www.csgomiddleman.com/{{randomString}} </div>
	<div class="col-sm-3 col-sm-offset-3"> (Share it with friend)</div>
</div>
<div class="row" style="height: 5vh;font-size:160%">
	<div class="col-sm-6 text-center" style="background-color: 	#A9A9A9; color: yellow"> Person submitting skins </div>
	<div class="col-sm-6 text-center" style="color: #4B0082" > Person submitting money</div>
</div>

<div class="row" style="height: 87vh; background-color: green color:#1E90FF">
	<div class="row" style="height: 77vh; background-color: blue; color:#1E90FF">
		<div class="col-sm-6" style="height: 100%; background-color: yellow;">

		<img src = "{{profile_image_url_large}}" style="margin-left: 18vw">
						<div class="text-center" style=" font-size:160%"> {{username}} </div>
		<button id="submit_skin_enable_button" class="btn btn-primary" style="margin-left: 19vw; margin-top: 2vh">Click to Submit skins</button>

			<div id="inventorylist" action="" class="container" style="margin-top: 2vh; display: none;">
			{% for item in tupleList %}
			    <input type="checkbox"  value="{{item.1}}"/>
<div style="display:inline-block" class="popupHoverElement">
    {{item.0}}

    <div id="two" class="popupBox"> <img src="http://community.edgecast.steamstatic.com/economy/image/{{item.2}}" /> </div>
</div> <br>
			   {% endfor %}
			    <button class="btn btn-primary" id="depositButton" style="margin-left: 15vw"> submit </button>
			</div>

			<input type="hidden" name="steamid" id="steamid" value="{{steamid}}">

      <div class="text-center" style="font-size: 140%"> Trade Status: <a id="status"> None sent </a> <img id="image" src="#" style="display: none;" />  </div>


		</div>
		<div class="col-sm-6" style="height: 100%; 	background-color: 	#4B0082;">

		
		<div class="text-center" style="margin-top: 30vh; font-size: 130%"> waiting for other user... </div>

		</div>
	</div>

	<div class="row text-center" style="height: 10vh; background-color: green; font-size:300%; color:white">
	<a style="color: white" id="full_status">Status: Waiting for submission from both.  </a> <img src="https://media.giphy.com/media/xUOrwrCJIJPHZ0IpdS/giphy.gif"/>
	</div>



</div>
<script src="{% static 'js/jquery-1.11.3.min.js' %}"></script>
<script src="http://localhost:3000/socket.io/socket.io.js"></script>
<script>
	$(function(){
		
	});

	// SOCKET SENDING
	$(document).ready(function(){

      var socket = io.connect('http://localhost:3000/');
      
      socket.on('connect', function(){
        console.log("connect");
      });
      
      $('#submit_skin_enable_button').click(function(){
			$('#inventorylist').show();
		})
		


      // var entry_el = $('#comment');
               
      socket.on('message', function(message) {
        //Escape HTML characters
        var data = message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
        
        //Append message to the bottom of the list
        // $('#comments').append('<li>' + data + '</li>');
         // window.scrollBy(0, 10000000000);
        // entry_el.focus();
       document.getElementById('status').text = data;
       $('#image').hide();
       if(data == "trade Accepted!"){
       document.getElementById('full_status').text = "skins submitted! waiting for money";}
      });


      $('#depositButton').click(function(){
			 var allVals = [];
			 $('#inventorylist :checked').each(function(){
		        allVals.push($(this).val());
		    });
		var msg = $('#steamid').val() + "," + allVals+"";
		console.log(msg);
		if(msg){
			console.log("message sent");
           socket.emit('send_message', msg, function(data){
                console.log(data);
           });
           $('#image').attr("src","https://media.giphy.com/media/3oKIPjbXj8FIL6eG3e/giphy.gif");
       document.getElementById('status').text = 'Trade Offer sent waiting';
            $('#image').show();

       }

		})




                     
      // entry_el.keypress(function(event){
      //   //When enter is pressed send input value to node server
      //   if(event.keyCode != 13) return;
      //   var msg = entry_el.attr('value');
      //   if(msg){
      //      socket.emit('send_message', msg, function(data){
      //           console.log(data);
      //      });
        
      //   //Clear input value   
      //   entry_el.attr('value', '');
      //  }
      // });
    });




</script>
</body>
</html>